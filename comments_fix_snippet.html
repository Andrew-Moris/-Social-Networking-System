
<script>
document.addEventListener("DOMContentLoaded", function() {
    console.log("ğŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª...");
    
    if (!document.querySelector('meta[name="user-id"]')) {
        const meta = document.createElement("meta");
        meta.name = "user-id";
        meta.content = "11";
        document.head.appendChild(meta);
        console.log("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© meta tag Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…");
    }
    
    if (typeof loadComments === "undefined") {
        window.loadComments = async function(postId) {
            console.log("ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„Ù„Ù…Ù†Ø´ÙˆØ±:", postId);
            const container = document.getElementById(`comments-container-${postId}`);
            
            if (!container) {
                console.log("âŒ Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©");
                return;
            }
            
            try {
                const response = await fetch(`api/social.php?action=get_comments&post_id=${postId}`);
                const result = await response.json();
                
                if (result.success && result.data.comments) {
                    if (result.data.comments.length === 0) {
                        container.innerHTML = '<div class="text-center py-4 text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</div>';
                    } else {
                        const currentUserId = parseInt(document.querySelector('meta[name="user-id"]').content);
                        container.innerHTML = result.data.comments.map(comment => `
                            <div class="comment-item" id="comment-${comment.id}">
                                <div class="flex gap-3">
                                    <img src="${comment.avatar_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(comment.username) + '&background=667eea&color=fff&size=80'}" 
                                         alt="${comment.username}" class="w-10 h-10 rounded-full object-cover">
                                    <div class="flex-1">
                                        <div class="flex items-center justify-between mb-1">
                                            <div class="flex items-center gap-2">
                                                <span class="font-semibold text-white">${comment.first_name} ${comment.last_name}</span>
                                                <span class="text-gray-400 text-sm">@${comment.username}</span>
                                                <span class="text-gray-500 text-xs">${formatDate ? formatDate(comment.created_at) : comment.created_at}</span>
                                            </div>
                                        </div>
                                        <p class="text-white mb-2">${comment.content}</p>
                                        <div class="flex gap-2">
                                            <button class="action-button text-xs">
                                                <i class="bi bi-heart"></i>
                                                <span>${comment.like_count || 0}</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                } else {
                    container.innerHTML = '<div class="text-center py-4 text-gray-400">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>';
                }
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª:", error);
                container.innerHTML = '<div class="text-center py-4 text-gray-400">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
            }
        };
        console.log("âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø¯Ø§Ù„Ø© loadComments");
    }
    
    if (typeof toggleComments === "undefined") {
        window.toggleComments = async function(postId) {
            console.log("ğŸ”„ ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„Ù„Ù…Ù†Ø´ÙˆØ±:", postId);
            const commentsSection = document.getElementById(`comments-${postId}`);
            
            if (!commentsSection) {
                console.log("âŒ Ù‚Ø³Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
                return;
            }
            
            if (commentsSection.style.display === "none" || commentsSection.style.display === "") {
                commentsSection.style.display = "block";
                await loadComments(postId);
            } else {
                commentsSection.style.display = "none";
            }
        };
        console.log("âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø¯Ø§Ù„Ø© toggleComments");
    }
    
    console.log("ğŸ‰ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
});
</script>
